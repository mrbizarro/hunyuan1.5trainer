build:
  gpu: true
  cuda: "12.4"
  python_version: "3.10"
  system_packages:
    - "libgl1-mesa-glx"
    - "libglib2.0-0"
    - "ffmpeg"
    - "git"
  python_packages:
    - "torch==2.5.1"
    - "torchvision==0.20.1"
    - "accelerate>=0.34.0"
    - "transformers>=4.46.0"
    - "diffusers>=0.32.0"
    - "peft>=0.13.0"
    - "safetensors>=0.4.0"
    - "einops>=0.8.0"
    - "sentencepiece>=0.2.0"
    - "bitsandbytes>=0.44.0"
    - "huggingface_hub>=0.26.0"
    - "opencv-python>=4.10.0"
    - "imageio>=2.36.0"
    - "imageio-ffmpeg>=0.5.0"
    - "pillow>=11.0.0"
    - "numpy>=1.26.0"
    - "tqdm>=4.66.0"
    - "pyyaml>=6.0"
    - "toml>=0.10.2"
    - "timm>=1.0.0"
    - "decord>=0.6.0"
    - "av"
    - "qwen-vl-utils"
  run:
    - "pip install flash-attn --no-build-isolation || true"
    - "curl -o /usr/local/bin/pget -L 'https://github.com/replicate/pget/releases/download/v0.6.0/pget_linux_amd64' && chmod +x /usr/local/bin/pget"
    - "git clone https://github.com/kohya-ss/musubi-tuner.git /src/musubi-tuner"
    - "mkdir -p /src/weights/text_encoder /src/weights/text_encoder_2"
    # HunyuanVideo 1.5 models from Comfy-Org
    - "pget https://huggingface.co/Comfy-Org/HunyuanVideo_1.5_repackaged/resolve/main/split_files/text_encoders/qwen_2.5_vl_7b.safetensors /src/weights/text_encoder/qwen_2.5_vl_7b.safetensors"
    - "pget https://huggingface.co/Comfy-Org/HunyuanVideo_1.5_repackaged/resolve/main/split_files/text_encoders/byt5_small_glyphxl_fp16.safetensors /src/weights/text_encoder_2/byt5_small_glyphxl_fp16.safetensors"
    - "pget https://huggingface.co/Comfy-Org/HunyuanVideo_1.5_repackaged/resolve/main/split_files/diffusion_models/hunyuanvideo1.5_720p_t2v_fp16.safetensors /src/weights/hunyuanvideo1.5_720p_t2v_fp16.safetensors"
    - "pget https://huggingface.co/Comfy-Org/HunyuanVideo_1.5_repackaged/resolve/main/split_files/vae/hunyuanvideo15_vae_fp16.safetensors /src/weights/hunyuanvideo15_vae_fp16.safetensors"

predict: "train.py:Predictor"
train: "train.py:train"
