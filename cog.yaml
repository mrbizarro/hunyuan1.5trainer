build:
  gpu: true
  cuda: "12.4"
  python_version: "3.10"
  system_packages:
    - "libgl1-mesa-glx"
    - "libglib2.0-0"
    - "ffmpeg"
    - "git"
    - "wget"
    - "aria2"
  python_packages:
    - "torch==2.5.1"
    - "torchvision==0.20.1"
    - "accelerate>=0.34.0"
    - "transformers>=4.46.0"
    - "diffusers>=0.32.0"
    - "peft>=0.13.0"
    - "safetensors>=0.4.0"
    - "einops>=0.8.0"
    - "sentencepiece>=0.2.0"
    - "bitsandbytes>=0.44.0"
    - "huggingface_hub>=0.26.0"
    - "opencv-python>=4.10.0"
    - "imageio>=2.36.0"
    - "imageio-ffmpeg>=0.5.0"
    - "pillow>=11.0.0"
    - "numpy>=1.26.0"
    - "tqdm>=4.66.0"
    - "pyyaml>=6.0"
    - "toml>=0.10.2"
    - "timm>=1.0.0"
    - "decord>=0.6.0"
    - "av"
    - "qwen-vl-utils"
  run:
    - "pip install flash-attn --no-build-isolation || true"
    - "git clone https://github.com/kohya-ss/musubi-tuner.git /src/musubi-tuner"
    - "mkdir -p /src/weights"

predict: "train.py:Predictor"
train: "train.py:train"
